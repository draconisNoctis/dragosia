<div>
    <h2 i18n>Melee</h2>
    <ng-container *ngTemplateOutlet="group; context: { type: 'melee', form: meleeForm }"></ng-container>
    <h2 i18n>Range</h2>
    <ng-container *ngTemplateOutlet="group; context: { type: 'range', form: rangeForm }"></ng-container>
    <h2 i18n>Physical</h2>
    <ng-container *ngTemplateOutlet="group; context: { type: 'physical', form: physicalForm }"></ng-container>
    <h2 i18n>Mental</h2>
    <ng-container *ngTemplateOutlet="group; context: { type: 'mental', form: mentalForm }"></ng-container>
    <h2 i18n>Gifts</h2>
    <ng-container *ngTemplateOutlet="group; context: { type: 'gifts', form: giftsForm }"></ng-container>
    <!--<h2 i18n>Melee</h2>
    <div formArrayName="melee" class="wrapper">
        <div class="row" *ngIf="mode === 'range' && meleeForm.controls.length > 0">
            <span></span>
            <ul class="legend">
                <li>+{{ 1 | costs }}</li>
                <li>+{{ 2 | costs }}</li>
                <li>+{{ 3 | costs }}</li>
                <li>+{{ 4 | costs }}</li>
                <li>+{{ 5 | costs }}</li>
            </ul>
        </div>
        <div class="row" *ngFor="let control of meleeForm.controls; let index = index" [formGroup]="control">
            <label>{{ control.value.name }}</label>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="attribute" i18n-placeholder placeholder="Attribute" />
            </mat-form-field>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="skill" i18n-placeholder placeholder="Skill" />
            </mat-form-field>
            <jui-radio-range deselectable [readonly]="mode === 'button'" [min]="mins.melee[index]" formControlName="value"></jui-radio-range>
            <div *ngIf="mode === 'button'" class="button-wrapper">
                <span i18n *ngIf="form.value.melee[index].value < 5">{{ (form.value.melee[index].value + 1) | costs:factor }} EP</span>
                <span *ngIf="form.value.melee[index].value >= 5"></span>
                <button mat-icon-button (click)="add('melee', index)" [disabled]="form.value.melee[index].value >= 5 || pointsAvailable < ((form.value.melee[index].value + 1) | costs:factor)"><mat-icon>add</mat-icon></button>
            </div>
        </div>
    </div>

    <h2 i18n>Range</h2>
    <div formArrayName="range" class="wrapper">
        <div class="row" *ngIf="mode === 'range' && rangeForm.controls.length > 0">
            <span></span>
            <ul class="legend">
                <li>+{{ 1 | costs }}</li>
                <li>+{{ 2 | costs }}</li>
                <li>+{{ 3 | costs }}</li>
                <li>+{{ 4 | costs }}</li>
                <li>+{{ 5 | costs }}</li>
            </ul>
        </div>
        <div class="row" *ngFor="let control of rangeForm.controls; let index = index" [formGroup]="control">
            <label>{{ control.value.name }}</label>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="attribute" i18n-placeholder placeholder="Attribute" />
            </mat-form-field>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="skill" i18n-placeholder placeholder="Skill" />
            </mat-form-field>
            <jui-radio-range deselectable [readonly]="mode === 'button'" [min]="mins.range[index]" formControlName="value"></jui-radio-range>
            <div *ngIf="mode === 'button'" class="button-wrapper">
                <span i18n *ngIf="form.value.range[index].value < 5">{{ (form.value.range[index].value + 1) | costs:factor }} EP</span>
                <span *ngIf="form.value.range[index].value >= 5"></span>
                <button mat-icon-button (click)="add('range', index)" [disabled]="form.value.range[index].value >= 5 || pointsAvailable < ((form.value.range[index].value + 1) | costs:factor)"><mat-icon>add</mat-icon></button>
            </div>
        </div>
    </div>

    <h2 i18n>Physical</h2>
    <div formArrayName="physical" class="wrapper">
        <div class="row" *ngIf="mode === 'range' && physicalForm.controls.length > 0">
            <span></span>
            <ul class="legend">
                <li>+{{ 1 | costs }}</li>
                <li>+{{ 2 | costs }}</li>
                <li>+{{ 3 | costs }}</li>
                <li>+{{ 4 | costs }}</li>
                <li>+{{ 5 | costs }}</li>
            </ul>
        </div>
        <div class="row" *ngFor="let control of physicalForm.controls; let index = index" [formGroup]="control">
            <label>{{ control.value.name }}</label>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="attribute" i18n-placeholder placeholder="Attribute" />
            </mat-form-field>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="skill" i18n-placeholder placeholder="Skill" />
            </mat-form-field>
            <jui-radio-range deselectable [readonly]="mode === 'button'" [min]="mins.physical[index]" formControlName="value"></jui-radio-range>
            <div *ngIf="mode === 'button'" class="button-wrapper">
                <span i18n *ngIf="form.value.physical[index].value < 5">{{ (form.value.physical[index].value + 1) | costs:factor }} EP</span>
                <span *ngIf="form.value.physical[index].value >= 5"></span>
                <button mat-icon-button (click)="add('physical', index)" [disabled]="form.value.physical[index].value >= 5 || pointsAvailable < ((form.value.physical[index].value + 1) | costs:factor)"><mat-icon>add</mat-icon></button>
            </div>
        </div>
    </div>

    <h2 i18n>Mental</h2>
    <div formArrayName="mental" class="wrapper">
        <div class="row" *ngIf="mode === 'range' && mentalForm.controls.length > 0">
            <span></span>
            <ul class="legend">
                <li>+{{ 1 | costs }}</li>
                <li>+{{ 2 | costs }}</li>
                <li>+{{ 3 | costs }}</li>
                <li>+{{ 4 | costs }}</li>
                <li>+{{ 5 | costs }}</li>
            </ul>
        </div>
        <div class="row" *ngFor="let control of mentalForm.controls; let index = index" [formGroup]="control">
            <label>{{ control.value.name }}</label>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="attribute" i18n-placeholder placeholder="Attribute" />
            </mat-form-field>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="skill" i18n-placeholder placeholder="Skill" />
            </mat-form-field>
            <jui-radio-range deselectable [readonly]="mode === 'button'" [min]="mins.mental[index]" formControlName="value"></jui-radio-range>
            <div *ngIf="mode === 'button'" class="button-wrapper">
                <span i18n *ngIf="form.value.mental[index].value < 5">{{ (form.value.mental[index].value + 1) | costs:factor }} EP</span>
                <span *ngIf="form.value.mental[index].value >= 5"></span>
                <button mat-icon-button (click)="add('mental', index)" [disabled]="form.value.mental[index].value >= 5 || pointsAvailable < ((form.value.mental[index].value + 1) | costs:factor)"><mat-icon>add</mat-icon></button>
            </div>
        </div>
    </div>

    <h2 i18n>Gifts</h2>
    <div formArrayName="gifts" class="wrapper">
        <div class="row" *ngIf="mode === 'range' && giftsForm.controls.length > 0">
            <span></span>
            <ul class="legend">
                <li>+{{ 1 | costs }}</li>
                <li>+{{ 2 | costs }}</li>
                <li>+{{ 3 | costs }}</li>
                <li>+{{ 4 | costs }}</li>
                <li>+{{ 5 | costs }}</li>
            </ul>
        </div>
        <div *ngFor="let control of giftsForm.controls; let index = index" [formGroup]="control">
            <label>{{ control.value.name }}</label>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="attribute" i18n-placeholder placeholder="Attribute" />
            </mat-form-field>
            <mat-form-field floatLabel="never">
                <input matInput formControlName="skill" i18n-placeholder placeholder="Skill" />
            </mat-form-field>
            <jui-radio-range deselectable [readonly]="mode === 'button'" [min]="mins.gifts[index]" formControlName="value"></jui-radio-range>
            <div *ngIf="mode === 'button'" class="button-wrapper">
                <span i18n *ngIf="form.value.gifts[index].value < 5">{{ (form.value.gifts[index].value + 1) | costs:factor }} EP</span>
                <span *ngIf="form.value.gifts[index].value >= 5"></span>
                <button mat-icon-button (click)="add('gifts', index)" [disabled]="form.value.gifts[index].value >= 5 || pointsAvailable < ((form.value.gifts[index].value + 1) | costs:factor)"><mat-icon>add</mat-icon></button>
            </div>
        </div>
    </div>-->
</div>

<ng-template #group let-type="type" let-form="form">
    <form [formGroup]="form" class="columns-8">
        <div>
            <ng-container *ngFor="let control of form.controls; let index = index" [formGroup]="control">
                <label class="no-border">{{ control.value.name }}</label>
                <span>{{ form.value[index].attribute }}</span>
                <span>{{ form.value[index].skill }}</span>
                <span>{{ form.value[index].level }}</span>
                <!--<mat-form-field floatLabel="never">
                    <input matInput formControlName="attribute" i18n-placeholder placeholder="Attribute" />
                </mat-form-field>
                <mat-form-field floatLabel="never">
                    <input matInput formControlName="skill" i18n-placeholder placeholder="Skill" />
                </mat-form-field>
                <mat-form-field floatLabel="never" class="border-right">
                    <mat-select formControlName="level" i18n-placeholder placeholder="Level">
                    <mat-option value="A">A</mat-option>
                    <mat-option value="B">B</mat-option>
                    <mat-option value="C">C</mat-option>
                    <mat-option value="D">D</mat-option>
                    <mat-option value="E">E</mat-option>
                    <mat-option value="F">F</mat-option>
                </mat-select>
                </mat-form-field>-->
                <div>
                    <button mat-icon-button (click)="delete(type, index)" *ngIf="mode !== 'button' && form.value[index].value <= 0"><mat-icon>delete</mat-icon></button>
                    <button mat-icon-button (click)="remove(type, index)" [disabled]="form.value[index].value <= 0" *ngIf="mode !== 'button' && form.value[index].value > 0"><mat-icon>remove</mat-icon></button>
                </div>
                <input type="number" [min]="mins[type][index]" [max]="max" formControlName="value" />
                <div><button mat-icon-button (click)="add(type, index)" [disabled]="form.value[index].value >= max || budget < getCostsForNext(index)"><mat-icon>add</mat-icon></button></div>
                <div class="costs-for-next"><span>+{{ getCostsForNext(form.value[index]) }}</span></div>
            </ng-container>
        </div>
    </form>
</ng-template>

<button mat-mini-fab (click)="openAddDialog()" [disabled]="pointsAvailable < 1"  matTooltip="Add Talent" i18n-matTooltip><mat-icon>add</mat-icon></button>
